.header
.title "IN-3 Documentation"
.author LJM Dullaart
.h1 History
In was a run-off format for web-pages. It was meant to create web pages 
of different formats. It worked quite well as long as the text was kept simple.

At some point, formatting requirements elaborate, using side-notes, tables and left-notes.
There was also the requirement of getting a PDF document, which was produced using tbl
and groff. I called this in2, having the nice pun in2html, in2groff etc.

By now, the code got quite complex. The difference between tables in html and tables in 
tbl made it necessary to dupplicate a lot of code. Adding features became quite a 
challenge.

I also picked up a book called 'Clean Code' by Robert Martin. That described 
exactly the problem I was having; dirty code. 

So a major rewrite became necessary. And it also became necessary to create a
sort of architecture document that describes the way in looks at formatting 
a document. It also describes the in input language, the in3 intermediate language
and what in does or doesn't do. In general, the real formatting is left to the
output-processor (either the formatting of the web page or Groff).


.h1 How to look at a document

.h2 Output document

A document consists of a number of pages. A page has the following structure:

.img in_page.png

A page consists of a
-	header, which should be static
-	a set of alineas that provide the actual content
-	a foot note section, which is specific for that page
-	a footer, which should be static as well.

Headers and footers should be static, because in some output formats (f.e. HTML),
they are printed only once.

An alinea consists of three parts:
-	a left-note part
-	the alinea body
-	the side-note part.

A header (chapter title etc.) is also seen as a specific alinea. For some alineas,
the left or side note section may be empty, either because no content is produced,
or by definition.

.h2 How notes work
Left and side notes follow a different pattern.

.h3 Left notes
Left notes apear as a column on the right of the text. The columnn for left notes starts
at the first alinea that uses a left note and the column ends at:
-	a .back request
-	a header (at any level)

A .back request does not break the alinea.

A left note is a simple blurb of text, just A-Z, a-z, 0-9 and possibly a space.

In in3, if a left note column is present, it must be specified, even if the left note
part for that alinea is empty.


.h3 Side notes
A column on the right is reserved if anywhere in the text a side note is requested. 

In in3, if a side note column is present, all alineas must specify the side note part.


.h1 In language specification
.h2 Special Characters

Some chararacters have a special meaning.
	%*Character%*	%*When%*	%*Meaning%*
	{tab}	always	Tab is an indication that a format construct (leftnote, table or list) is used
	..	beginning of line	A dot at the beginning of a line indicates a request
	%	when interpret=2	Next characters are interpreted
	-	beginning of line or after tab(s)	list item in a dash-list
	#	beginning of line or after tab(s)	list item in a numbered-list
	@	beginning of line or after tab(s)	list item in a alpha-list

.h2 Implemented requests

	%*request%*	%*argument%*	%*meaning%*
	empty line or .	 	Ends an alinea, if an alinea is open
	-{tab}	text	dash list item
	{tab}-{tab}	text	second level dash list
	@{tab}	text	alphabetized list item
	{tab}@{tab}	text	second level alphabetized list
	#{tab}	text	numbered list item
	{tab}#{tab}	text	second level numbered list
	text{tab}	text	a text with a left note
	author	text	specify the name(s) of the author(s)
	b	text	text must be written in bold
	back	none	Ends a section with left notes
	br	none	force a line break
	global	variable value	set the variable to value globally
	h{0-5}	text	create a chapter/section/... title
	header	none	include the file header if that seems appropriate
	hr	none	horizontal line
	i	text	italized text
	img	image	include an image here
	map	image  image_file	Map creates a clickable map in HTML or an image in PDF.
	map	field link coordinates	Creates a click-field on the current map.
	note	text	text is a footnote
	pre	none	starts or stops a pre-formatted text
	set	variable value	set the variable to value from now on
	side	side note text	Specifies a referal to sidenotes
	u	text	Underline text

Tables, maps and lists are defined as block requests. They should start on a new alinea
and end with an alinea (i.e. a blank line).


.h2 Variables

The concept of variables is used to control the behaviour of the in-scripts. Variables may be
set globally or from a point in the text. If a variable is set as global, the last value in the
input file is used from the beginning. Global variables may be overridden by set requests.

Variables have consequences.

	%*Variable%*	 	%*Meaning%*
	interpret	global	0=only accented characters<br>1=%% style interpretation<br>2=direct interpretation
	notes	direct	0=no left or side notes<br>1=only leftnotes<br>2=only sidenotes<br>3=both
	H1	direct	Number for the next chapter
	H2	direct	Number for the next section
	H3	direct	Number for the next paragraph
	H4	direct	Number for the next sub-paragraph


.h1 The h3 intermediate data structure

In3 is an intermediate language. The goal of the intermediate language
is to provide all the content in the right order, in such a way that the
output-filters can easily produce the output.

.h2 In3 format
The format of in3 is as follows:
.pre
{IN3 TAG}content 
.pre
In3 tags are meant to be generated by the in3 pre-processors, but their content
should be fairly readable. The following tags are used:
	%*tag%*	%*Argument%*	%*meaning%*
	ALINEA	notes flag	start of a new alinea; 0:no notes, 1:leftnote, 2:sidenote, 3:both
	ALINEAEND	 	End of aalinea
	AUTHOR	name(s)	Name of the authors
	DEBUG level	message	Debugging information. Discarded.
	HEADER level	text	Header at level with text.
	HEADUNNUM level	text	An unnumbered header at level.
	IMAGE	filename	Include an image here
	LEFTNOTE	leftnote text 	start of the left note part
	LINE	 	Draw a horizintal line
	LINEBREAK	 	Forced line break
	LISTALPHAEND	 level	End alpha list
	LISTALPHASTART	level	Start a alpha-list
	LISTALPHAITEM	text	alpha list item
	LISTDASHEND	 level	End dash list
	LISTDASHSTART	level	Start a dash-list
	LISTDASHITEM	text	Dash list item
	LISTNUMEND	 level	End numeric list
	LISTNUMSTART	level	Start a numeric-list
	LISTNUMITEM	text	numeric list item
	LITTERAL	text	text to be outputted as pre-formatted text
	MAPSTART	 	Start a clickable map
	MAPPICT	filename	Use the image for the map
	MAPFIELD	link coordinates	Create a click-field on the map
	MAPEND	 	End the currend map
	NOTE	text	Footnote
	SET	variable value	Set variable to value
	SIDENOTE	text	Sidenote
	SUBTITLE	text	Create a subtitle for the document
	<rs=3>TABLECEL	text	Create a table cel with text as content
	rs=x	Tag that allows the cell to span rows
	cs=x	Tag that allows the cell to span columns
	TABLEEND		End of a table
	TABLEROW		Start a new table row
	TABLEROWEND		End of a table row
	TABLESTART		Start of a table
	TEXTBOLD	text	Text to be written in bold face
	TEXTITALIC	text	Text to be written in italic
	TEXTUNDERLINE	text	Text to be underlined
	TEXTNORMAL	text	Normal text as part of the alinea body

.h1 Stylesheets

In3 supports stylesheets per output-type. 

.h2  HTML style sheet

.pre
BODY {
	color: #111111;
	background-color: #EEEEEE;
}
PRE {
	color: #00FF00;
	background-color: #001100;
	margin: 20px;
	padding: 20px;
}
.toc {
	color: #000000;
	background-color: #DDDDDD;
	width: 100%;
}
table.note td {
	vertical-allign: top;
}

table.normal {
 border: 1px solid #ddd;
}

table.normal tr {
 border: 1px solid #ddd;
}
table.normal td {
 border: 1px solid #ddd;
}

.side {
	font-size: 50%;
}
.left {
	font-size: 80%;
}
.fixed {
	font-family:courier, "courier new", monospace;
}
.pre

.h2 Groff style sheet
.pre

  .ds Licon "Table of Contents"

.pre
